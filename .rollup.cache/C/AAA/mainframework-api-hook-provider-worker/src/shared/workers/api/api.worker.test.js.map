{"version":3,"file":"api.worker.test.js","sourceRoot":"","sources":["api.worker.test.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference types=\"jest\" />\r\n/// <reference types=\"node\" />\r\nimport { Worker } from \"worker_threads\";\r\nimport path from \"path\";\r\n\r\nconst workerScriptPath = path.resolve(process.cwd(), \"test-worker-bootstrap.mjs\");\r\nconst worker = new Worker(workerScriptPath);\r\n\r\nfunction send(data: unknown): Promise<unknown> {\r\n  return new Promise((resolve, reject) => {\r\n    const handler = (payload: { msg?: unknown; error?: string }) => {\r\n      worker.off(\"message\", handler);\r\n      if (payload.error) reject(new Error(payload.error));\r\n      else resolve(payload.msg);\r\n    };\r\n    worker.on(\"message\", handler);\r\n    worker.postMessage({ dataRequest: data });\r\n    setTimeout(() => {\r\n      worker.off(\"message\", handler);\r\n      reject(new Error(\"Timeout\"));\r\n    }, 5000);\r\n  });\r\n}\r\n\r\nfunction sendNoResponse(data: unknown): Promise<void> {\r\n  worker.postMessage({ dataRequest: data });\r\n  return new Promise((r) => setTimeout(r, 50));\r\n}\r\n\r\nafterAll(async () => {\r\n  await worker.terminate();\r\n});\r\n\r\ndescribe(\"api.worker\", () => {\r\n  describe(\"validation\", () => {\r\n    it(\"responds with error when type is missing\", async () => {\r\n      const msg = await send({ cacheName: \"x\", hookId: \"h1\" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"error\",\r\n        data: { kind: \"validation\", message: \"Invalid request: type is required\", code: \"INVALID_REQUEST\" },\r\n        hookId: \"h1\",\r\n      });\r\n    });\r\n\r\n    it(\"responds with error when type is empty string\", async () => {\r\n      const msg = await send({ type: \"\", cacheName: \"x\" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"error\",\r\n        data: { kind: \"validation\", code: \"INVALID_REQUEST\" },\r\n      });\r\n    });\r\n\r\n    it(\"responds with error when cacheName is missing for get\", async () => {\r\n      const msg = await send({ type: \"get\", hookId: \"h1\" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"error\",\r\n        data: { kind: \"validation\", message: \"Invalid request: cacheName is required\", code: \"INVALID_REQUEST\" },\r\n      });\r\n    });\r\n\r\n    it(\"responds with error when cacheName is empty string for get\", async () => {\r\n      const msg = await send({ type: \"get\", cacheName: \"   \" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"error\",\r\n        data: { kind: \"validation\", code: \"INVALID_REQUEST\" },\r\n      });\r\n    });\r\n\r\n    it(\"responds with error when payload is missing for set without request\", async () => {\r\n      const msg = await send({ type: \"set\", cacheName: \"valid-key\", hookId: \"h1\" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"error\",\r\n        data: { kind: \"validation\", message: \"Invalid request: payload is required for set\", code: \"INVALID_REQUEST\" },\r\n      });\r\n    });\r\n\r\n    it(\"responds with error when payload is null for non-GET API request\", async () => {\r\n      const msg = await send({\r\n        type: \"set\",\r\n        cacheName: \"valid-key\",\r\n        request: { url: \"https://example.com\", method: \"POST\" },\r\n        hookId: \"h1\",\r\n      });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"error\",\r\n        data: {\r\n          kind: \"validation\",\r\n          message: \"Invalid request: payload is required for non-GET API request\",\r\n          code: \"INVALID_REQUEST\",\r\n        },\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"cancel\", () => {\r\n    it(\"handles cancel without throwing\", async () => {\r\n      await sendNoResponse({ type: \"cancel\" });\r\n    });\r\n\r\n    it(\"handles cancel with requestId\", async () => {\r\n      await sendNoResponse({ type: \"cancel\", requestId: \"req-1\" });\r\n    });\r\n  });\r\n\r\n  describe(\"get\", () => {\r\n    it(\"responds with CACHE_MISS when key is not in cache\", async () => {\r\n      const msg = await send({ type: \"get\", cacheName: \"nonexistent-key\", hookId: \"h1\" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"nonexistent-key\",\r\n        data: { kind: \"validation\", message: \"Cache miss\", code: \"CACHE_MISS\" },\r\n        hookId: \"h1\",\r\n      });\r\n    });\r\n\r\n    it(\"responds with cached data when key exists\", async () => {\r\n      const cacheName = \"get-hit-\" + Math.random();\r\n      await sendNoResponse({ type: \"set\", cacheName, payload: { value: 42 }, hookId: \"h1\" });\r\n      const msg = await send({ type: \"get\", cacheName, hookId: \"h2\" });\r\n      expect(msg).toMatchObject({ cacheName, data: { value: 42 }, hookId: \"h2\" });\r\n    });\r\n\r\n    it(\"normalizes cacheName to lowercase for get\", async () => {\r\n      const cacheName = \"GetCase-\" + Math.random();\r\n      await sendNoResponse({ type: \"set\", cacheName: cacheName.toUpperCase(), payload: { x: 1 } });\r\n      const msg = await send({ type: \"get\", cacheName: cacheName.toLowerCase() });\r\n      expect(msg).toMatchObject({ cacheName: cacheName.toLowerCase(), data: { x: 1 } });\r\n    });\r\n  });\r\n\r\n  describe(\"set (cache only)\", () => {\r\n    it(\"stores payload when no request; get returns stored data\", async () => {\r\n      const cacheName = \"set-cache-\" + Math.random();\r\n      await sendNoResponse({ type: \"set\", cacheName, payload: { a: 1, b: 2 }, hookId: \"h1\" });\r\n      const msg = await send({ type: \"get\", cacheName });\r\n      expect(msg).toMatchObject({ cacheName, data: { a: 1, b: 2 } });\r\n    });\r\n  });\r\n\r\n  describe(\"delete\", () => {\r\n    it(\"removes key and responds with deleted: true\", async () => {\r\n      const cacheName = \"delete-key-\" + Math.random();\r\n      await sendNoResponse({ type: \"set\", cacheName, payload: { keep: true } });\r\n      const delMsg = await send({ type: \"delete\", cacheName, hookId: \"h1\" });\r\n      expect(delMsg).toMatchObject({ cacheName, data: { deleted: true }, hookId: \"h1\" });\r\n      const getMsg = await send({ type: \"get\", cacheName });\r\n      expect(getMsg).toMatchObject({\r\n        cacheName,\r\n        data: { kind: \"validation\", message: \"Cache miss\", code: \"CACHE_MISS\" },\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"onmessage\", () => {\r\n    it(\"ignores message without dataRequest and worker still works\", async () => {\r\n      worker.postMessage({});\r\n      await new Promise((r) => setTimeout(r, 50));\r\n      const msg = await send({ type: \"get\", cacheName: \"after-empty-msg\", hookId: \"h1\" });\r\n      expect(msg).toMatchObject({\r\n        cacheName: \"after-empty-msg\",\r\n        data: { kind: \"validation\", message: \"Cache miss\", code: \"CACHE_MISS\" },\r\n      });\r\n    });\r\n  });\r\n\r\n  describe(\"set with request (HTTP)\", () => {\r\n    it(\"GET request returns data and httpStatus\", async () => {\r\n      const cacheName = \"http-get-\" + Math.random();\r\n      const msg = (await send({\r\n        type: \"set\",\r\n        cacheName,\r\n        request: { url: \"https://httpbin.org/get\", method: \"GET\" },\r\n        hookId: \"h1\",\r\n      })) as { cacheName: string; hookId?: string; httpStatus?: number; data?: { url?: string } };\r\n      expect(msg).toMatchObject({ cacheName, hookId: \"h1\" });\r\n      expect(msg.httpStatus).toBe(200);\r\n      expect(msg.data).toBeDefined();\r\n      expect(msg.data?.url).toBe(\"https://httpbin.org/get\");\r\n    });\r\n  });\r\n});\r\n"]}