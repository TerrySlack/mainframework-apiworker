{"version":3,"file":"api.worker.js","sourceRoot":"","sources":["api.worker.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference lib=\"webworker\" />\r\n\r\nimport type {\r\n  AbortControllers,\r\n  BinaryParseResult,\r\n  BinaryResponseMeta,\r\n  DataRequest,\r\n  StackArray,\r\n  WorkerApiRequest,\r\n} from \"../../types/types\";\r\n\r\nconst callerResponse = <T>(cacheName: string, data: T, hookId?: string | null, httpStatus?: number): void => {\r\n  if ((data !== undefined && data !== null) || httpStatus !== undefined) {\r\n    self.postMessage({ cacheName, data: data ?? null, hookId, httpStatus });\r\n  }\r\n};\r\n\r\n/**\r\n * Binary response - transferred via postMessage, not stored in cache.\r\n * Client receives ArrayBuffer + meta for reconstruction (e.g. new Blob([data], { type })).\r\n */\r\nconst callerResponseBinary = (\r\n  cacheName: string,\r\n  data: ArrayBuffer,\r\n  meta: BinaryResponseMeta,\r\n  hookId?: string | null,\r\n  httpStatus?: number,\r\n): void => {\r\n  if (data) {\r\n    self.postMessage({ cacheName, data, meta, hookId, httpStatus }, [data]);\r\n  }\r\n};\r\n\r\nconst store = Object.create(null) as Record<string, unknown>;\r\nconst normalizeKey = (key: string) => key.toLocaleLowerCase();\r\nconst get = <TData>(key: string): TData | undefined => store[normalizeKey(key)] as TData | undefined;\r\nconst set = <TData>(key: string, value: TData): void => {\r\n  store[normalizeKey(key)] = value;\r\n};\r\nconst remove = (key: string): void => {\r\n  delete store[normalizeKey(key)];\r\n};\r\n\r\n/** Returns headers without Content-Type (either casing). Use when FormData sets it automatically. */\r\nconst omitContentType = (headers: Record<string, string>): Record<string, string> => {\r\n  const rest = { ...headers };\r\n  delete rest[\"Content-Type\"];\r\n  delete rest[\"content-type\"];\r\n  return rest;\r\n};\r\n\r\nconst isBinaryResponse = (r: unknown): r is BinaryParseResult =>\r\n  !!r && typeof r === \"object\" && \"__binary\" in r && (r as { __binary: unknown }).__binary === true;\r\n\r\nconst commit = <TData>(cacheName: string, data: TData, hookId?: string | null, httpStatus?: number): void => {\r\n  if (cacheName) {\r\n    set(normalizeKey(cacheName), data);\r\n    callerResponse(cacheName, data, hookId, httpStatus);\r\n    return;\r\n  }\r\n\r\n  callerResponse(\"error\", { error: \"Invalid commit: cacheName is required\", code: \"INVALID_REQUEST\" }, hookId);\r\n};\r\n\r\n/**\r\n * Parses response based on content-type.\r\n * Returns parsed data for JSON/text, or { __binary, data, contentType, contentDisposition } for binary.\r\n */\r\nconst parseResponseByContentType = async (response: Response): Promise<unknown> => {\r\n  const contentType = response.headers.get(\"content-type\")?.toLocaleLowerCase() || \"\";\r\n  const contentLength = response.headers.get(\"content-length\");\r\n\r\n  // No content\r\n  if (response.status === 204 || contentLength === \"0\") {\r\n    return null;\r\n  }\r\n\r\n  // JSON types - let it throw if malformed\r\n  if (contentType.includes(\"json\")) {\r\n    return await response.json();\r\n  }\r\n\r\n  // Text-based types\r\n  if (\r\n    contentType.startsWith(\"text/\") ||\r\n    contentType.includes(\"xml\") ||\r\n    contentType.includes(\"javascript\") ||\r\n    contentType.includes(\"x-www-form-urlencoded\")\r\n  ) {\r\n    return await response.text();\r\n  }\r\n\r\n  // Binary types (known or fallback) - use arrayBuffer for zero-copy transfer to client\r\n  const arrayBuffer = await response.arrayBuffer();\r\n  return {\r\n    __binary: true as const,\r\n    data: arrayBuffer,\r\n    contentType,\r\n    contentDisposition: response.headers.get(\"content-disposition\"),\r\n  };\r\n};\r\n\r\n// Top-level helper\r\nconst appendToFormData = (formData: FormData, key: string, value: unknown): void => {\r\n  if (value instanceof File) {\r\n    formData.append(\"Files\", value, value.name);\r\n    return;\r\n  }\r\n\r\n  if (value instanceof Blob) {\r\n    formData.append(\"Files\", value, \"blob\");\r\n    return;\r\n  }\r\n\r\n  if (value !== undefined && value !== null) {\r\n    if (typeof value === \"object\") {\r\n      formData.append(key, JSON.stringify(value));\r\n    } else {\r\n      const primitive = value as string | number | boolean | bigint | symbol;\r\n      formData.append(key, String(primitive));\r\n    }\r\n  }\r\n};\r\n\r\nconst pushObjectToStack = (\r\n  obj: Record<string, unknown>,\r\n  parentKey: string,\r\n  stack: Array<{ key: string; value: unknown }>,\r\n) => {\r\n  for (const k in obj) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, k)) {\r\n      stack.push({\r\n        key: parentKey ? `${parentKey}.${k}` : k,\r\n        value: obj[k],\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nconst createFormDataIfBlobOrFile = (payload: unknown): FormData | null => {\r\n  if (payload === null || payload === undefined || typeof payload !== \"object\") {\r\n    return null;\r\n  }\r\n\r\n  const formData = new FormData();\r\n  let hasFile = false;\r\n\r\n  const stack: StackArray[] = [];\r\n\r\n  if (Array.isArray(payload)) {\r\n    let i = 0;\r\n    while (i < payload.length) {\r\n      stack.push({ key: String(i), value: payload[i] });\r\n      i++;\r\n    }\r\n  } else {\r\n    pushObjectToStack(payload as Record<string, unknown>, \"\", stack);\r\n  }\r\n\r\n  // Safe iteration - iterate forward, then clear\r\n  for (let i = 0; i < stack.length; i++) {\r\n    const entry = stack[i];\r\n    if (entry === undefined) continue;\r\n    const { key, value } = entry;\r\n\r\n    if (value instanceof File || value instanceof Blob) {\r\n      hasFile = true;\r\n      appendToFormData(formData, key, value);\r\n      continue;\r\n    }\r\n\r\n    if (Array.isArray(value)) {\r\n      let j = 0;\r\n      while (j < value.length) {\r\n        stack.push({ key: `${key}.${j}`, value: value[j] });\r\n        j++;\r\n      }\r\n      continue;\r\n    }\r\n\r\n    if (value !== null && typeof value === \"object\") {\r\n      pushObjectToStack(value as Record<string, unknown>, key, stack);\r\n      continue;\r\n    }\r\n\r\n    appendToFormData(formData, key, value);\r\n  }\r\n\r\n  return hasFile ? formData : null;\r\n};\r\n//Extracts Content-Type from headers object Returns \"application/json\" if not found\r\nconst getContentType = (headers: Record<string, string> = {}): string =>\r\n  headers[\"Content-Type\"] || headers[\"content-type\"] || \"application/json\";\r\n\r\nconst getPayloadType = (payload: unknown): string => {\r\n  switch (true) {\r\n    case payload instanceof FormData:\r\n      return \"formdata\";\r\n    case payload instanceof Blob:\r\n      return \"blob\";\r\n    case payload instanceof ArrayBuffer:\r\n      return \"arraybuffer\";\r\n    case ArrayBuffer.isView(payload):\r\n      return \"arraybufferview\";\r\n    case payload instanceof ReadableStream:\r\n      return \"stream\";\r\n    case typeof payload === \"string\":\r\n      return \"string\";\r\n    default:\r\n      return \"object\";\r\n  }\r\n};\r\n\r\nconst prepareRequestBody = (\r\n  payload: unknown,\r\n  headers: Record<string, string>,\r\n): { body?: BodyInit; headers: Record<string, string> } => {\r\n  const payloadType = getPayloadType(payload);\r\n\r\n  switch (payloadType) {\r\n    case \"formdata\":\r\n      return {\r\n        body: payload as FormData,\r\n        headers: omitContentType(headers),\r\n      };\r\n\r\n    case \"blob\":\r\n      return {\r\n        body: payload as Blob,\r\n        headers,\r\n      };\r\n\r\n    case \"arraybuffer\":\r\n      return {\r\n        body: payload as ArrayBuffer,\r\n        headers,\r\n      };\r\n\r\n    case \"arraybufferview\":\r\n      return {\r\n        body: payload as BodyInit,\r\n        headers,\r\n      };\r\n\r\n    case \"stream\":\r\n      return {\r\n        body: payload as ReadableStream<Uint8Array>,\r\n        headers,\r\n      };\r\n\r\n    case \"string\":\r\n      return {\r\n        body: payload as string,\r\n        headers,\r\n      };\r\n\r\n    case \"object\": {\r\n      const contentType = getContentType(headers);\r\n      let body: BodyInit;\r\n      let finalHeaders = headers;\r\n\r\n      if (contentType.includes(\"application/json\")) {\r\n        body = JSON.stringify(payload);\r\n      } else if (contentType.includes(\"application/x-www-form-urlencoded\")) {\r\n        body = new URLSearchParams(payload as Record<string, string>).toString();\r\n      } else if (contentType.startsWith(\"text/\") || contentType.includes(\"xml\")) {\r\n        body = String(payload);\r\n      } else if (contentType.includes(\"multipart/form-data\")) {\r\n        const formData = createFormDataIfBlobOrFile(payload);\r\n        if (formData) {\r\n          body = formData;\r\n          finalHeaders = omitContentType(headers);\r\n        } else {\r\n          body = JSON.stringify(payload);\r\n          finalHeaders = {\r\n            ...headers,\r\n            \"Content-Type\": \"application/json\",\r\n          };\r\n        }\r\n      } else {\r\n        body = JSON.stringify(payload);\r\n      }\r\n\r\n      if (!finalHeaders[\"Content-Type\"] && !finalHeaders[\"content-type\"]) {\r\n        finalHeaders = {\r\n          ...headers,\r\n          \"Content-Type\": contentType,\r\n        };\r\n      }\r\n\r\n      return { body, headers: finalHeaders };\r\n    }\r\n\r\n    default:\r\n      return { headers };\r\n  }\r\n};\r\n\r\nconst inFlightControllers: AbortControllers = new Map();\r\nconst inFlightByCacheName = new Map<string, Promise<void>>();\r\n\r\nconst apiRequest = async <TData>(\r\n  cacheName: string,\r\n  payload: TData | FormData | null,\r\n  { url, method, headers = {}, mode = \"cors\", credentials = \"include\" }: WorkerApiRequest,\r\n  requestId?: string | null,\r\n  hookId?: string | null,\r\n): Promise<void> => {\r\n  const existing = inFlightByCacheName.get(cacheName);\r\n  if (existing) {\r\n    await existing;\r\n    const cached = get(cacheName);\r\n    if (cached !== undefined) callerResponse(cacheName, cached, hookId);\r\n    return;\r\n  }\r\n\r\n  const controller = new AbortController();\r\n  if (requestId) {\r\n    inFlightControllers.set(requestId, controller);\r\n  }\r\n\r\n  const promise = (async (): Promise<void> => {\r\n    const fetchOptions: RequestInit = {\r\n      method,\r\n      mode,\r\n      credentials,\r\n      signal: controller.signal,\r\n    };\r\n\r\n    if (method.toUpperCase() !== \"GET\" && payload != null) {\r\n      const { body, headers: processedHeaders } = prepareRequestBody(payload, headers);\r\n      if (body !== undefined) fetchOptions.body = body;\r\n      fetchOptions.headers = processedHeaders;\r\n    } else {\r\n      fetchOptions.headers = omitContentType(headers);\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(url, fetchOptions);\r\n\r\n      if (!response.ok) {\r\n        callerResponse(cacheName, { error: response.statusText, code: response.status }, hookId, response.status);\r\n        return;\r\n      }\r\n\r\n      if (response.status === 204) {\r\n        set(normalizeKey(cacheName), null);\r\n        callerResponse(cacheName, null, hookId, 204);\r\n        return;\r\n      }\r\n\r\n      const responseData = await parseResponseByContentType(response);\r\n\r\n      if (isBinaryResponse(responseData)) {\r\n        callerResponseBinary(\r\n          cacheName,\r\n          responseData.data,\r\n          {\r\n            contentType: responseData.contentType,\r\n            contentDisposition: responseData.contentDisposition ?? null,\r\n          },\r\n          hookId,\r\n          response.status,\r\n        );\r\n      } else {\r\n        commit(cacheName, responseData, hookId, response.status);\r\n      }\r\n    } catch (error) {\r\n      if ((error as Error).name === \"AbortError\") {\r\n        return;\r\n      }\r\n      const err = error as Error;\r\n      const code = err.name === \"TypeError\" ? \"NETWORK_ERROR\" : \"UNKNOWN\";\r\n      callerResponse(cacheName, { error: err.message, code }, hookId);\r\n    } finally {\r\n      if (requestId) {\r\n        inFlightControllers.delete(requestId);\r\n      }\r\n      inFlightByCacheName.delete(cacheName);\r\n    }\r\n  })();\r\n\r\n  inFlightByCacheName.set(cacheName, promise);\r\n  await promise;\r\n};\r\n\r\nconst onRequest = <TData>(dataRequest: DataRequest<TData>): void => {\r\n  if (!dataRequest?.type) {\r\n    callerResponse(\r\n      \"error\",\r\n      { error: \"Invalid request: type is required\", code: \"INVALID_REQUEST\" },\r\n      dataRequest?.hookId,\r\n    );\r\n    return;\r\n  }\r\n  const { cacheName, type, payload, request, requestId, hookId } = dataRequest;\r\n  const lowerType = normalizeKey(type);\r\n\r\n  if (lowerType === \"cancel\") {\r\n    if (requestId) onCancel(requestId);\r\n    return;\r\n  }\r\n\r\n  if (!cacheName) {\r\n    callerResponse(\"error\", { error: \"Invalid request: cacheName is required\", code: \"INVALID_REQUEST\" }, hookId);\r\n    return;\r\n  }\r\n  const lowerCacheName = normalizeKey(cacheName);\r\n\r\n  if (lowerType === \"get\") {\r\n    const requestedData = get(lowerCacheName);\r\n    if (requestedData === undefined) {\r\n      callerResponse(lowerCacheName, { error: \"Cache miss\", code: \"CACHE_MISS\" }, hookId);\r\n    } else {\r\n      callerResponse(lowerCacheName, requestedData, hookId);\r\n    }\r\n  } else if (lowerType === \"set\") {\r\n    if (!request) {\r\n      set(lowerCacheName, payload);\r\n    } else {\r\n      void apiRequest(lowerCacheName, payload ?? null, request, requestId, hookId);\r\n    }\r\n  } else if (lowerType === \"delete\") {\r\n    remove(lowerCacheName);\r\n    callerResponse(lowerCacheName, { deleted: true }, hookId);\r\n  }\r\n};\r\n\r\nconst onCancel = (requestId: string): void => {\r\n  const controller = inFlightControllers.get(requestId);\r\n  if (controller) {\r\n    controller.abort();\r\n    inFlightControllers.delete(requestId);\r\n  }\r\n};\r\n\r\ntype WorkerMessageData = { dataRequest?: DataRequest<unknown> };\r\n\r\nonmessage = (event: MessageEvent): void => {\r\n  const data = event.data as unknown;\r\n  if (data === null || typeof data !== \"object\") return;\r\n  const dataRequest = (data as WorkerMessageData).dataRequest;\r\n  if (dataRequest !== undefined) onRequest(dataRequest);\r\n};\r\n"]}